<app-navbar></app-navbar>
<div class="container">
  <p class="container__title">Métricas</p>
  <div class="metrics-damages">
    <p class="metrics-damages__title">Daños</p>
    <div class="metrics-damages__select">
      <mat-form-field>
        <mat-label>Período</mat-label>
        <mat-select [(value)]="selectedDamagedPeriod" (selectionChange)="onDamagePeriodChange($event)">
          <mat-option *ngFor="let option of periodOptions" [value]="option.value">
            {{ option.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="metrics-damages__cards">
      <div *ngIf="damagesLoading" class="loading">
        <mat-spinner></mat-spinner>
      </div>
      <div *ngIf="!damagesLoading" class="metrics-card">
        <p>Vehículos dañados: {{ damageStats.vehicleDamagesCount }}</p>
      </div>
      <div *ngIf="!damagesLoading" class="metrics-card">
        <p>Contenedores dañados: {{ damageStats.containerDamagesCount }}</p>
      </div>
    </div>
  </div>
  <div class="metrics-recolections">
    <p class="metrics-recolections__title">Recolecciones</p>
    <div class="metrics-recolections__types">
      <div *ngIf="currentRecolectionLoading" class="loading">
        <mat-spinner></mat-spinner>
      </div>
      <div *ngIf="!currentRecolectionLoading" class="metrics-card">
        <p>Planificadas: {{ recolectionCurrentStats.planifiedCount }}</p>
      </div>
      <div *ngIf="!currentRecolectionLoading" class="metrics-card">
        <p>Vehículo pendiente: {{ recolectionCurrentStats.vehiclePendingCount }}</p>
      </div>
      <div *ngIf="!currentRecolectionLoading" class="metrics-card">
        <p>En curso: {{ recolectionCurrentStats.inProgressCount }}</p>
      </div>
    </div>
    <div class="metrics-recolections__historic">
      <div class="metrics-recolections__select-left">
        <mat-form-field>
          <mat-label>Período</mat-label>
          <mat-select [(value)]="selectedRecolectionPeriod" (selectionChange)="onRecolectionPeriodChange($event)">
            <mat-option *ngFor="let option of periodOptions" [value]="option.value">
              {{ option.viewValue }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="metrics-recolections__cards">
        <div *ngIf="historicRecolectionLoading" class="loading">
          <mat-spinner></mat-spinner>
        </div>
        <div *ngIf="!historicRecolectionLoading" class="metrics-card">
          <p>Canceladas: {{ recolectionHistoricStats.canceledCount }}</p>
        </div>
        <div *ngIf="!historicRecolectionLoading" class="metrics-card">
          <p>Finalizadas: {{ recolectionHistoricStats.finalizedCount }}</p>
        </div>
      </div>
    </div>
  </div>
  <div class="metrics-top">
    <p class="metrics-top__title">Top recolecciones finalizadas</p>
    <div class="metrics-damages__select">
      <mat-form-field>
        <mat-label>Período</mat-label>
        <mat-select [(value)]="selectedTopPeriod" (selectionChange)="onTopPeriodChange($event)">
          <mat-option *ngFor="let option of periodOptions" [value]="option.value">
            {{ option.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="metrics-top__tables">
      <div *ngIf="topRecolectionLoading" class="loading">
        <mat-spinner></mat-spinner>
      </div>
      <div class="table" *ngIf="!topRecolectionLoading">
        <table mat-table [dataSource]="recolectionTopStats.topEmployees">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Nombre </th>
            <td mat-cell *matCellDef="let employee"> {{employee.name}} </td>
          </ng-container>
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef> Cantidad </th>
            <td mat-cell *matCellDef="let employee"> {{employee.quantity}} </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['name', 'quantity']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['name', 'quantity'];"></tr>
        </table>
      </div>
      <div class="table" *ngIf="!topRecolectionLoading">
        <table mat-table [dataSource]="recolectionTopStats.topVehicles">
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Descripción </th>
            <td mat-cell *matCellDef="let vehicle"> {{vehicle.patent}} - {{vehicle.description}} </td>
          </ng-container>
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef> Cantidad </th>
            <td mat-cell *matCellDef="let vehicle"> {{vehicle.quantity}} </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['description', 'quantity']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['description', 'quantity'];"></tr>
        </table>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
